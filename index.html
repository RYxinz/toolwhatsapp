<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WA Tool Bramz Ultra Chat Admin</title>
<style>
body{
  margin:0;
  font-family:'Arial',sans-serif;
  color:#fff;
  background:#0a0a0a url('https://i.ibb.co/5GZPqG6/anime-bg.jpg') no-repeat center center fixed;
  background-size:cover;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  overflow-x:hidden;
}
.overlay{
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.7);
  z-index:-1;
}
.box{
  background:rgba(0,0,0,0.7);
  border:2px solid #0ff;
  padding:20px;
  width:90%;
  max-width:900px;
  border-radius:12px;
  box-shadow:0 0 20px #0ff,0 0 40px #f0f;
  margin-bottom:20px;
  animation:glow 2s infinite alternate;
}
h2{text-align:center;color:#0ff;text-shadow:0 0 5px #0ff,0 0 10px #f0f,0 0 20px #0ff;margin-bottom:15px}
input,textarea,button,select{width:100%;margin-top:10px;padding:12px;border-radius:8px;border:none;outline:none;font-size:16px}
input,textarea,select{background:rgba(0,0,0,0.8);color:#0ff;border:1px solid #0ff;text-shadow:0 0 3px #0ff}
textarea{resize:none;}
button{background:#0ff;color:#000;font-weight:bold;cursor:pointer;box-shadow:0 0 10px #0ff,0 0 20px #f0f;transition:0.3s}
button:hover{background:#f0f;color:#fff;box-shadow:0 0 15px #f0f,0 0 30px #0ff}
.link{text-align:center;font-size:14px;margin-top:10px;color:#94a3b8;cursor:pointer}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:15px;color:#0ff;font-size:14px}
th,td{border:1px solid #0ff;padding:6px;text-align:center}
th{background:#164e63}
tr:hover{background:rgba(0,255,255,0.1)}
.red{background:#ef4444;color:#fff;cursor:pointer}
.green{background:#22c55e;color:#fff;cursor:pointer}
.stat{display:flex;justify-content:space-around;margin-bottom:20px;flex-wrap:wrap}
.stat div{background:rgba(0,255,255,0.1);padding:15px;border-radius:10px;text-align:center;flex:1 1 150px;margin:5px;border:1px solid #0ff}
.stat div h3{font-size:20px;color:#0ff;margin-bottom:5px;text-shadow:0 0 5px #0ff}
.stat div p{font-size:16px;color:#f0f}
#chartContainer{width:100%;max-width:800px;margin:0 auto}
#chatBox{background:rgba(0,0,0,0.8);border:1px solid #0ff;padding:10px;height:250px;overflow-y:auto;border-radius:10px}
.chat-message{margin:5px 0;padding:6px;border-radius:6px;}
.chat-user{background:rgba(0,255,255,0.2);text-align:left}
.chat-admin{background:rgba(255,0,255,0.2);text-align:right}
@keyframes glow{
  0%{box-shadow:0 0 10px #0ff,0 0 20px #f0f;}
  50%{box-shadow:0 0 20px #f0f,0 0 40px #0ff;}
  100%{box-shadow:0 0 10px #0ff,0 0 20px #f0f;}
}
@media(max-width:480px){
  input,textarea,button,select{font-size:14px;padding:10px}
  h2{font-size:20px}
  table{font-size:12px}
  .stat{flex-direction:column;align-items:center}
}
</style>
</head>
<body>
<div class="overlay"></div>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h2>Login</h2>
<input id="loginUser" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<div class="link" onclick="showRegister()">Belum punya akun? Register</div>
</div>

<!-- REGISTER -->
<div class="box hidden" id="registerBox">
<h2>Register</h2>
<input id="regUser" placeholder="Username">
<input id="regPass" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<div class="link" onclick="showLogin()">Sudah punya akun? Login</div>
</div>

<!-- DASHBOARD USER -->
<div class="box hidden" id="dashBox">
<h2>WA Sender + Chat</h2>
<input id="nomor" placeholder="Nomor WA (62xxx)">
<textarea id="pesan" rows="3" placeholder="Tulis pesan WA..."></textarea>
<button onclick="kirimWA()">Kirim WhatsApp</button>

<h3 style="margin-top:15px;">Chat Admin</h3>
<div id="chatBox"></div>
<textarea id="chatInput" rows="2" placeholder="Tulis pesan ke admin..."></textarea>
<button onclick="sendChat()">Kirim Chat</button>

<button onclick="logout()" style="margin-top:12px;background:#ef4444;color:#fff">Logout</button>
</div>

<!-- ADMIN PANEL -->
<div class="box hidden" id="adminBox">
<h2>Admin Dashboard</h2>
<div class="stat">
  <div><h3 id="totalUser">0</h3><p>Total User</p></div>
  <div><h3 id="activeUser">0</h3><p>Active</p></div>
  <div><h3 id="bannedUser">0</h3><p>Banned</p></div>
  <div><h3 id="totalWA">0</h3><p>WA Sent</p></div>
</div>

<div id="chartContainer"><canvas id="waChart"></canvas></div>

<h3>User Chat Log</h3>
<select id="selectUser" onchange="renderSelectedUserChat()"></select>
<div id="chatBoxAdmin" style="background:rgba(0,0,0,0.8);border:1px solid #0ff;padding:10px;height:250px;overflow-y:auto;border-radius:10px"></div>

<table id="userTable">
<tr><th>No</th><th>Username</th><th>Status</th><th>WA Sent</th><th>Aksi</th></tr>
</table>

<button onclick="logout()" style="margin-top:12px;background:#ef4444;color:#fff">Logout</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const loginBox=document.getElementById("loginBox")
const registerBox=document.getElementById("registerBox")
const dashBox=document.getElementById("dashBox")
const adminBox=document.getElementById("adminBox")
const chatBox=document.getElementById("chatBox")
const chatInput=document.getElementById("chatInput")
const chatBoxAdmin=document.getElementById("chatBoxAdmin")
const selectUser=document.getElementById("selectUser")

// SHOW LOGIN/REGISTER
function showRegister(){loginBox.classList.add("hidden");registerBox.classList.remove("hidden")}
function showLogin(){registerBox.classList.add("hidden");loginBox.classList.remove("hidden")}

// REGISTER
function register(){
  let u=regUser.value.trim()
  let p=regPass.value.trim()
  if(!u||!p){alert("Lengkapi data");return}
  if(localStorage.getItem("user_"+u)){alert("Username sudah ada");return}
  let userData={pass:p,banned:false,waSent:0,chat:[]}
  localStorage.setItem("user_"+u,JSON.stringify(userData))
  alert("Register berhasil")
  showLogin()
}

// LOGIN
function login(){
  let u=loginUser.value.trim()
  let p=loginPass.value.trim()
  if(u==="admin"&&p==="admin123"){ 
    localStorage.setItem("login","admin")
    loginBox.classList.add("hidden");adminBox.classList.remove("hidden")
    renderUsers();updateStats();renderChart();renderUserSelect()
    return
  }
  let data=localStorage.getItem("user_"+u)
  if(!data){alert("User tidak ditemukan");return}
  let user=JSON.parse(data)
  if(user.banned){alert("Akun anda dibanned!");return}
  if(user.pass===p){
    localStorage.setItem("login",u)
    loginBox.classList.add("hidden");dashBox.classList.remove("hidden")
    renderUserChat()
  } else alert("Password salah")
}

// LOGOUT
function logout(){localStorage.removeItem("login");location.reload()}

// WA SENDER
function kirimWA(){
  let n=document.getElementById("nomor").value.replace(/\D/g,'')
  let t=document.getElementById("pesan").value
  if(!n||!t){alert("Isi nomor & pesan");return}
  window.open("https://wa.me/"+n+"?text="+encodeURIComponent(t),"_blank")
  let u=localStorage.getItem("login")
  if(u && u!=="admin"){
    let data=JSON.parse(localStorage.getItem("user_"+u))
    data.waSent=(data.waSent||0)+1
    localStorage.setItem("user_"+u,JSON.stringify(data))
  }
  renderUsers();updateStats();renderChart()
}

// CHAT USER
function sendChat(){
  let u=localStorage.getItem("login")
  if(!u || u==="admin") return
  let msg=chatInput.value.trim()
  if(!msg) return
  let data=JSON.parse(localStorage.getItem("user_"+u))
  data.chat.push({text:msg,time:new Date().toLocaleString(),sender:"user"})
  localStorage.setItem("user_"+u,JSON.stringify(data))
  chatInput.value=""
  renderUserChat()
  renderUserSelect()
}

// RENDER CHAT USER
function renderUserChat(){
  let u=localStorage.getItem("login")
  if(u && u!=="admin"){
    let data=JSON.parse(localStorage.getItem("user_"+u))
    chatBox.innerHTML=""
    data.chat.forEach(c=>{
      let div=document.createElement("div")
      div.className="chat-message chat-"+c.sender
      div.innerText=`[${c.time}] ${c.text}`
      chatBox.appendChild(div)
    })
    chatBox.scrollTop=chatBox.scrollHeight
  }
}

// ADMIN PANEL
let waChart=null;
function renderUsers(){
  let table=document.getElementById("userTable")
  table.innerHTML="<tr><th>No</th><th>Username</th><th>Status</th><th>WA Sent</th><th>Aksi</th></tr>"
  let keys=Object.keys(localStorage).filter(k=>k.startsWith("user_"))
  keys.forEach((k,i)=>{
    let username=k.replace("user_","")
    let data=JSON.parse(localStorage.getItem(k))
    let row=table.insertRow()
    row.insertCell(0).innerText=i+1
    row.insertCell(1).innerText=username
    row.insertCell(2).innerText=data.banned?"Banned":"Active"
    row.insertCell(3).innerText=data.waSent||0
    let actions=row.insertCell(4)
    let banBtn=document.createElement("button")
    banBtn.innerText=data.banned?"Unban":"Ban"
    banBtn.className=data.banned?"green":"red"
    banBtn.onclick=()=>{
      data.banned=!data.banned
      localStorage.setItem(k,JSON.stringify(data))
      renderUsers();updateStats();renderChart();renderUserSelect()
    }
    let delBtn=document.createElement("button")
    delBtn.innerText="Hapus"
    delBtn.className="red"
    delBtn.style.marginLeft="5px"
    delBtn.onclick=()=>{
      if(confirm("Hapus user "+username+"?")){
        localStorage.removeItem(k)
        renderUsers();updateStats();renderChart();renderUserSelect()
      }
    }
    actions.appendChild(banBtn)
    actions.appendChild(delBtn)
  })
  updateStats()
}

// UPDATE STATISTICS
function updateStats(){
  let keys=Object.keys(localStorage).filter(k=>k.startsWith("user_"))
  let total=keys.length
  let active=keys.filter(k=>!JSON.parse(localStorage.getItem(k)).banned).length
  let banned=total-active
  let totalWA=keys.reduce((sum,k)=>sum+(JSON.parse(localStorage.getItem(k)).waSent||0),0)
  document.getElementById("totalUser").innerText=total
  document.getElementById("activeUser").innerText=active
  document.getElementById("bannedUser").innerText=banned
  document.getElementById("totalWA").innerText=totalWA
}

// RENDER CHART
function renderChart(){
  let keys=Object.keys(localStorage).filter(k=>k.startsWith("user_"))
  let labels=keys.map(k=>k.replace("user_",""))
  let data=keys.map(k=>JSON.parse(localStorage.getItem(k)).waSent||0)
  if(waChart) waChart.destroy()
  let ctx=document.getElementById("waChart").getContext("2d")
  waChart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:labels,
      datasets:[{
        label:'WA Sent per User',
        data:data,
        backgroundColor:'rgba(0,255,255,0.5)',
        borderColor:'#0ff',
        borderWidth:1
      }]
    },
    options:{
      responsive:true,
      scales:{y:{beginAtZero:true,stepSize:1}},
      plugins:{legend:{labels:{color:'#0ff'}}}
    }
  })
}

// ADMIN CHAT
function renderUserSelect(){
  let keys=Object.keys(localStorage).filter(k=>k.startsWith("user_"))
  selectUser.innerHTML=""
  keys.forEach(k=>{
    let opt=document.createElement("option")
    opt.value=k.replace("user_","")
    opt.innerText=k.replace("user_","")
    selectUser.appendChild(opt)
  })
  renderSelectedUserChat()
}

function renderSelectedUserChat(){
  let selected=selectUser.value
  if(!selected) return
  let data=JSON.parse(localStorage.getItem("user_"+selected))
  chatBoxAdmin.innerHTML=""
  data.chat.forEach(c=>{
    let div=document.createElement("div")
    div.className="chat-message chat-"+c.sender
    div.innerText=`[${c.time}] ${c.text}`
    chatBoxAdmin.appendChild(div)
  })
  chatBoxAdmin.scrollTop=chatBoxAdmin.scrollHeight
}

// AUTO LOGIN
if(localStorage.getItem("login")){
  let l=localStorage.getItem("login")
  if(l==="admin"){loginBox.classList.add("hidden");adminBox.classList.remove("hidden");renderUsers();renderChart();renderUserSelect()}
  else{loginBox.classList.add("hidden");dashBox.classList.remove("hidden");renderUserChat()}
}

// REAL-TIME CHAT REFRESH (1s)
setInterval(()=>{
  if(dashBox.classList.contains("hidden")==false) renderUserChat()
  if(adminBox.classList.contains("hidden")==false) renderSelectedUserChat()
},1000)
</script>
</body>
  </html>
